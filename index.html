<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’¸ Gastos</title>

<style>
body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #eceff1;
  font-size: 18px;
  color: #222;
}

.container {
  max-width: 450px;
  margin: auto;
  padding: 14px;
}

h2 {
  text-align: center;
  margin-bottom: 10px;
  font-size: 24px;
}

.card {
  background: #ffffff;
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 18px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 17px;
  border-radius: 8px;
  border: 1px solid #ccc;
  box-sizing: border-box;
}

textarea {
  resize: vertical;
}

button {
  background: #2c3e50;
  color: white;
  border: none;
  margin-top: 16px;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  background: #1b2838;
}

button.export {
  background: #27ae60;
}

button.export:hover {
  background: #1f8f4c;
}

.monto-container {
  display: flex;
  gap: 8px;
}

.dashboard {
  font-size: 16px;
}

.dashboard .total {
  font-size: 22px;
  font-weight: bold;
  color: #2c3e50;
}

.dashboard .uso-general {
  font-size: 18px;
  font-weight: bold;
  color: #27ae60;
  margin-bottom: 8px;
}

.dashboard .categoria {
  margin: 6px 0;
}

.progress-bar {
  background: #ddd;
  border-radius: 8px;
  height: 12px;
  width: 100%;
  margin-top: 4px;
}

.progress-fill {
  height: 100%;
  border-radius: 8px;
  background: #3498db;
  text-align: right;
  padding-right: 4px;
  color: white;
  font-size: 12px;
  line-height: 12px;
}

.borrar-btn {
  background: #e74c3c;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  padding: 2px 6px;
  font-size: 14px;
  margin-left: 6px;
}
</style>
</head>

<body>
<div class="container">

<h2>ğŸ’¸ Registro de Gastos</h2>

<div class="card">
<form id="formGasto">

<label>ğŸ“… Fecha</label>
<input type="date" id="fecha" required>

<label>ğŸ“‚ Categoria</label>
<select id="categoria"></select>

<label>ğŸ“ Subcategoria</label>
<select id="subcategoria"></select>

<label>ğŸ‘¤ Beneficiario</label>
<select id="beneficiario">
  <option>YO</option>
  <option>FAMILIA</option>
  <option>MASCOTAS</option>
  <option>OTROS</option>
</select>

<label>ğŸ“ Lugar</label>
<select id="lugar">
  <option>CASA</option>
  <option>CALLE</option>
  <option>TRABAJO</option>
  <option>ONLINE</option>
</select>

<label>ğŸ’µ Monto</label>
<div class="monto-container">
  <select id="montoDolar"></select>
  <select id="montoCentavo"></select>
</div>

<label>ğŸ’³ Medio de pago</label>
<select id="medioPago">
  <option>EFECTIVO</option>
  <option>TRANSFERENCIA</option>
  <option>ONLINE GYE</option>
  <option>ONLINE PEIGO</option>
  <option>DEBITO GYE</option>
  <option>CREDITO JEP</option>
</select>

<label>ğŸ“ Detalle</label>
<textarea id="detalle"></textarea>

<label>ğŸ—’ï¸ Observacion</label>
<textarea id="observacion"></textarea>

<button type="submit">Guardar</button>

</form>
</div>

<h2>ğŸ“Š Dashboard</h2>
<div class="card dashboard" id="dashboard"></div>

<button class="export" onclick="exportar()">ğŸ“¤ Exportar a Excel</button>
</div>

<script>
// Presupuestos por categoria
const PRESUPUESTOS = {
  ALIMENTACION: 330,
  TRANSPORTE: 290,
  SALUD: 90,
  OCIO: 15,
  SOCIAL: 50,
  MASCOTAS: 40,
  AUTO: 50,
  HOGAR: 75,
  DEUDAS: 70
};

// Categorias con emojis
const categorias = {
  ALIMENTACION: ["SOCIAL ğŸ»","SUPERMERCADO ğŸ›’","RESTAURANTE ğŸ½ï¸","GIMNASIO ğŸ‹ï¸","CAFE â˜•","TIENDA ğŸª"],
  TRANSPORTE: ["GASOLINA â›½","BUS ğŸšŒ","UBER ğŸš—","TAXI ğŸš•","TRICIMOTO ğŸ›µ","ESTACIONAMIENTO ğŸ…¿ï¸","GARAGE ğŸ "],
  SALUD: ["CONSULTAS ğŸ©º","EXAMENES ğŸ§ª","MEDICAMENTOS ğŸ’Š","SUPLEMENTOS ğŸ¥¤","ASEO PERSONAL ğŸ§´","SKINCARE ğŸ§¼"],
  OCIO: ["VIAJES âœˆï¸","SUBSCRIPCIONES ğŸ“±","FUN ğŸ”¥"],
  SOCIAL: ["HOTEL ğŸ¨","AIRBNB ğŸ ","PAGOS ğŸ’³"],
  MASCOTAS: ["COMIDA ğŸ¶","VETERINARIO ğŸ¾","MEDICINA ğŸ•"],
  AUTO: ["REPUESTOS ğŸ› ï¸","ACEITE ğŸ›¢ï¸","LAVADA ğŸš¿","LLANTAS ğŸ›","MECANICO ğŸ”§","FILTROS ğŸ§°"],
  HOGAR: ["INTERNET ğŸŒ","LUZ ğŸ’¡","AGUA ğŸ’§"],
  DEUDAS: ["DEPRATI ğŸ›ï¸","JEP ğŸ¦","CLARO ğŸ“±","ICLOUD â˜ï¸","ETAFASHION ğŸ‘—"]
};

// Elementos DOM
const categoria = document.getElementById("categoria");
const subcategoria = document.getElementById("subcategoria");
const dashboard = document.getElementById("dashboard");
const montoDolar = document.getElementById("montoDolar");
const montoCentavo = document.getElementById("montoCentavo");

// Llenar selects de monto tipo iphone
for(let i=0;i<=1000;i++) montoDolar.innerHTML += `<option>${i}</option>`;
for(let i=0;i<100;i++) montoCentavo.innerHTML += `<option>${i}</option>`;

// Cargar categorias
function cargarCategorias() {
  categoria.innerHTML = "";
  Object.keys(categorias).forEach(c => {
    categoria.innerHTML += `<option>${c}</option>`;
  });
  actualizarSub();
}

// Actualizar subcategorias
function actualizarSub() {
  subcategoria.innerHTML = "";
  categorias[categoria.value].forEach(s => {
    subcategoria.innerHTML += `<option>${s}</option>`;
  });
}

categoria.onchange = actualizarSub;

// Guardar gasto
document.getElementById("formGasto").onsubmit = e => {
  e.preventDefault();

  const gasto = {
    fecha: fecha.value,
    categoria: categoria.value,
    subcategoria: subcategoria.value,
    beneficiario: beneficiario.value,
    lugar: lugar.value,
    monto: Number(montoDolar.value) + Number(montoCentavo.value)/100,
    medioPago: medioPago.value,
    detalle: detalle.value,
    observacion: observacion.value
  };

  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  gastos.push(gasto);
  localStorage.setItem("gastos", JSON.stringify(gastos));

  e.target.reset();
  cargarCategorias();
  actualizarDashboard();
};

// Dashboard con barras de progreso y ultimo gasto
function actualizarDashboard() {
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  const mesActual = new Date().toISOString().slice(0,7);
  const delMes = gastos.filter(g => g.fecha.startsWith(mesActual));

  if(delMes.length===0){
    dashboard.innerHTML = "Sin gastos este mes";
    return;
  }

  let total=0;
  const porCategoria={};

  delMes.forEach(g=>{
    total+=g.monto;
    porCategoria[g.categoria]=(porCategoria[g.categoria]||0)+g.monto;
  });

  const totalPresupuesto = Object.values(PRESUPUESTOS).reduce((a,b)=>a+b,0);

  let html = `<div class="total">ğŸ’° Total mes: $${total.toFixed(2)}</div>`;
  html += `<div class="uso-general">ğŸ“ˆ Uso presupuesto total: ${((total/totalPresupuesto)*100).toFixed(1)}%</div><hr>`;

  // Suma por todas las categorias con barras de progreso
  Object.keys(PRESUPUESTOS).forEach(c=>{
    const gastoCat = porCategoria[c] || 0;
    const pct=((gastoCat/PRESUPUESTOS[c])*100);
    const pctDisplay=pct.toFixed(1);
    html+=`<div class="categoria">${c}: $${gastoCat.toFixed(2)} / $${PRESUPUESTOS[c]} (${pctDisplay}%)</div>`;
    html+=`<div class="progress-bar"><div class="progress-fill" style="width:${Math.min(pct,100)}%"></div></div>`;
  });

  // Ultimo gasto ingresado con boton âŒ
  const ultimo = delMes[delMes.length-1];
  html += `<hr><div><strong>Ultimo gasto ingresado:</strong></div>`;
  html += `<div style="display:flex; justify-content:space-between; align-items:center; margin:2px 0; font-size:14px;">
            <span>${ultimo.fecha} - ${ultimo.categoria} / ${ultimo.subcategoria} - $${ultimo.monto.toFixed(2)}</span>
            <button class="borrar-btn" onclick="eliminarUltimoGasto()">âŒ</button>
           </div>`;

  dashboard.innerHTML=html;
}

// FunciÃ³n para eliminar el ultimo gasto
function eliminarUltimoGasto(){
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  if(gastos.length===0) return;
  gastos.pop();
  localStorage.setItem("gastos", JSON.stringify(gastos));
  actualizarDashboard();
}

// Exportar a CSV
function exportar(){
  const gastos=JSON.parse(localStorage.getItem("gastos")||"[]");
  if(!gastos.length) return;

  let csv=Object.keys(gastos[0]).join(",")+"\n";
  gastos.forEach(g=>{
    csv+=Object.values(g).join(",")+"\n";
  });

  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="gastos.csv";
  a.click();
}

// Inicializacion

// --- FECHA POR DEFECTO HOY ---
const hoy = new Date().toISOString().slice(0,10);
fecha.value = hoy;
// -----------------------------

cargarCategorias();
actualizarDashboard();
</script>

</body>
</html>
