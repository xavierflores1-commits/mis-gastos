<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’¸ Mis Gastos</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f7;
  margin: 0;
  padding: 16px;
}

h1, h2 {
  text-align: center;
}

.card {
  background: white;
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 16px;
}

input, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 16px;
}

button {
  background: #007aff;
  color: white;
  border: none;
  margin-top: 16px;
}

nav {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}

nav button {
  flex: 1;
}

.hidden {
  display: none;
}

canvas {
  margin-top: 24px;
}
</style>
</head>

<body>

<h1>ğŸ’¸ Control de Gastos</h1>

<nav>
  <button onclick="mostrar('registro')">â• Registrar</button>
  <button id="btnDashboard" onclick="mostrar('dashboard')">ğŸ“Š Dashboard</button>
</nav>

<!-- REGISTRO -->
<section id="registro" class="card">
  <h2>â• Nuevo gasto</h2>

  <label>ğŸ“… Fecha</label>
  <input type="date" id="fecha">

  <label>ğŸ’µ DÃ³lares</label>
  <select id="dolares"></select>

  <label>ğŸª™ Centavos</label>
  <select id="centavos"></select>

  <label>ğŸ“‚ CategorÃ­a</label>
  <select id="categoria" onchange="cargarSubcategorias()"></select>

  <label>ğŸ“ SubcategorÃ­a</label>
  <select id="subcategoria"></select>

  <label>ğŸ“ Lugar</label>
  <select id="lugar"></select>

  <label>ğŸ‘¤ Beneficiario</label>
  <input id="beneficiario" placeholder="Ej: Yo, Familia, Mascota">

  <button onclick="guardarGasto()">ğŸ’¾ Guardar</button>
</section>

<!-- DASHBOARD -->
<section id="dashboard" class="hidden">
  <div class="card">
    <h2>ğŸ“Š Dashboard</h2>
    <h3>Total gastado</h3>
    <p id="totalGastado">$0.00</p>
  </div>

  <div class="card">
    <h3>Por categorÃ­a</h3>
    <canvas id="chartCategorias"></canvas>
  </div>

  <div class="card">
    <h3>Por dÃ­a</h3>
    <canvas id="chartDias"></canvas>
  </div>

  <button onclick="exportarExcel()">ğŸ“¤ Exportar a Excel</button>
</section>

<script>
/* DATOS BASE */
const categorias = {
  "ğŸ½ AlimentaciÃ³n": ["Supermercado", "Restaurante", "CafÃ©"],
  "ğŸš— Transporte": ["Gasolina", "Uber", "Bus"],
  "ğŸ¥ Salud": ["Medicamentos", "ExÃ¡menes", "Consultas"],
  "ğŸ‰ Ocio": ["Cine", "Viajes", "Suscripciones"],
  "ğŸ¶ Mascotas": ["Comida", "Veterinario"],
  "ğŸ‘¥ Social": ["Regalos", "Salidas"],
  "ğŸš˜ Auto": ["Repuestos", "Mantenimiento"]
};

const lugares = ["Supermercado", "Farmacia", "Gasolinera", "Online", "Otro"];

/* INICIALIZACIÃ“N */
function init() {
  const hoy = new Date().toISOString().split("T")[0];
  fecha.value = hoy;

  for (let i = 0; i <= 500; i++) {
    dolares.innerHTML += `<option>${i}</option>`;
  }
  for (let i = 0; i < 100; i++) {
    centavos.innerHTML += `<option>${i.toString().padStart(2,'0')}</option>`;
  }

  for (let c in categorias) {
    categoria.innerHTML += `<option>${c}</option>`;
  }

  lugares.forEach(l => lugar.innerHTML += `<option>${l}</option>`);

  cargarSubcategorias();
}
init();

/* SUBCATEGORÃAS */
function cargarSubcategorias() {
  subcategoria.innerHTML = "";
  categorias[categoria.value].forEach(sc => {
    subcategoria.innerHTML += `<option>${sc}</option>`;
  });
}

/* GUARDAR */
function guardarGasto() {
  const gasto = {
    fecha: fecha.value,
    monto: parseFloat(dolares.value) + parseFloat("0." + centavos.value),
    categoria: categoria.value,
    subcategoria: subcategoria.value,
    lugar: lugar.value,
    beneficiario: beneficiario.value || "N/A"
  };

  const gastos = JSON.parse(localStorage.getItem("gastos")) || [];
  gastos.push(gasto);
  localStorage.setItem("gastos", JSON.stringify(gastos));

  alert("âœ… Gasto guardado");
}

/* NAVEGACIÃ“N */
function mostrar(id) {
  registro.classList.add("hidden");
  dashboard.classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

/* DASHBOARD */
function actualizarDashboard() {
  const gastos = JSON.parse(localStorage.getItem("gastos")) || [];
  if (gastos.length === 0) return;

  const total = gastos.reduce((s, g) => s + g.monto, 0);
  totalGastado.innerText = "$" + total.toFixed(2);

  const porCategoria = {};
  const porDia = {};

  gastos.forEach(g => {
    porCategoria[g.categoria] = (porCategoria[g.categoria] || 0) + g.monto;
    porDia[g.fecha] = (porDia[g.fecha] || 0) + g.monto;
  });

  new Chart(chartCategorias, {
    type: "pie",
    data: { labels: Object.keys(porCategoria), datasets: [{ data: Object.values(porCategoria) }] }
  });

  new Chart(chartDias, {
    type: "line",
    data: { labels: Object.keys(porDia), datasets: [{ label: "Gasto diario", data: Object.values(porDia) }] }
  });
}

btnDashboard.addEventListener("click", actualizarDashboard);

/* EXPORTAR */
function exportarExcel() {
  const gastos = JSON.parse(localStorage.getItem("gastos")) || [];
  let csv = "Fecha,CategorÃ­a,SubcategorÃ­a,Lugar,Beneficiario,Monto\n";

  gastos.forEach(g => {
    csv += `${g.fecha},${g.categoria},${g.subcategoria},${g.lugar},${g.beneficiario},${g.monto}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "gastos.csv";
  a.click();
}
</script>

</body>
</html>
