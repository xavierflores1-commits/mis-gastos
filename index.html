<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’¸ Mis Gastos</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background:#f2f2f7;
  margin:0;
  padding:16px;
}
h1,h2 { text-align:center; }
.card {
  background:white;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
}
label {
  font-weight:600;
  margin-top:12px;
  display:block;
}
select,input,button {
  width:100%;
  padding:12px;
  font-size:16px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #ccc;
}
.monto {
  display:flex;
  gap:10px;
}
.monto select { flex:1; }
button {
  background:#007aff;
  color:white;
  border:none;
  margin-top:20px;
}
.tab {
  display:flex;
  gap:10px;
  margin-bottom:16px;
}
.tab button {
  flex:1;
  background:#e5e5ea;
  color:black;
}
.tab button.active {
  background:#007aff;
  color:white;
}
canvas {
  width:100%;
  height:220px;
  margin-top:12px;
}
</style>
</head>

<body>

<h1>ğŸ’¸ Mis Gastos</h1>

<div class="tab">
  <button onclick="mostrar('registro')" class="active">ğŸ“ Registrar</button>
  <button onclick="mostrar('dashboard')">ğŸ“Š Dashboard</button>
</div>

<!-- REGISTRO -->
<div id="registro" class="card">

<label>ğŸ“… Fecha</label>
<input type="date" id="fecha">

<label>ğŸ’µ Monto</label>
<div class="monto">
  <select id="dolares"></select>
  <select id="centavos"></select>
</div>

<label>ğŸ“‚ CategorÃ­a</label>
<select id="categoria"></select>

<label>ğŸ“ SubcategorÃ­a</label>
<select id="subcategoria"></select>

<label>ğŸ‘¤ Beneficiario</label>
<select id="beneficiario">
  <option>Yo</option>
  <option>Familia</option>
  <option>Otros</option>
</select>

<label>ğŸ“ Lugar</label>
<select id="lugar">
  <option>Casa</option>
  <option>Trabajo</option>
  <option>Supermercado</option>
  <option>Farmacia</option>
  <option>Gasolinera</option>
  <option>Restaurante</option>
  <option>Gimnasio</option>
  <option>Online</option>
  <option>Otro</option>
</select>

<label>ğŸ’³ Medio de pago</label>
<select id="pago">
  <option>Efectivo</option>
  <option>Tarjeta</option>
  <option>Peigo</option>
  <option>Online-Gye</option>
  <option>Online-Peigo</option>
</select>

<button onclick="guardar()">ğŸ’¾ Guardar gasto</button>

</div>

<!-- DASHBOARD -->
<div id="dashboard" class="card" style="display:none">

<h2>ğŸ“Š Resumen general</h2>

<canvas id="grafico"></canvas>

<div id="resumen"></div>

<button onclick="exportar()">ğŸ“¤ Exportar a Excel</button>

</div>

<script>
// ================== INICIAL ==================
fecha.value = new Date().toISOString().split("T")[0];

for(let i=0;i<=500;i++){
  dolares.innerHTML += `<option>${i}</option>`;
}
for(let i=0;i<100;i++){
  centavos.innerHTML += `<option>${i.toString().padStart(2,"0")}</option>`;
}

// ================== CATEGORÃAS ==================
const categorias = {
"ğŸ½ï¸ ALIMENTACIÃ“N": [
  "ğŸ›’ Supermercado","ğŸ³ Desayuno","ğŸ› Almuerzo","ğŸ½ï¸ Cena",
  "ğŸª Snacks","ğŸ¥¤ Bebidas","ğŸ‚ CumpleaÃ±os"
],
"ğŸš— TRANSPORTE": [
  "â›½ Gasolina","ğŸš• Taxi","ğŸšŒ Bus","ğŸ› ï¸ Mantenimiento",
  "ğŸ”© Repuestos","ğŸ›£ï¸ Peajes","ğŸ…¿ï¸ Parqueo"
],
"ğŸ©º SALUD": [
  "ğŸ¥ Farmacia","ğŸ’Š Medicamentos","ğŸ‘¨â€âš•ï¸ Consulta mÃ©dica",
  "ğŸ§ª ExÃ¡menes","ğŸ‹ï¸ Gimnasio","ğŸ’§ HidrataciÃ³n","ğŸ¥› Suplementos"
],
"ğŸ‰ OCIO": [
  "ğŸ“º Streaming","ğŸ¬ Cine","ğŸ» Salidas","âœˆï¸ Viajes","ğŸ›ï¸ Compras personales"
],
"ğŸ SOCIAL": [
  "ğŸ Regalos","ğŸ‚ CumpleaÃ±os","ğŸ½ï¸ Invitaciones","â¤ï¸ Donaciones"
],
"ğŸ¾ MASCOTAS": [
  "ğŸ– Comida","ğŸ¶ Veterinario","ğŸ§¼ Higiene","ğŸ¦´ Accesorios"
],
"ğŸ  HOGAR": [
  "ğŸ§¹ Compras hogar","ğŸ”§ Mantenimiento hogar","ğŸ’§ Agua","ğŸ’¡ Luz"
]
};

for(let c in categorias){
  categoria.innerHTML += `<option>${c}</option>`;
}

function cargarSub(){
  subcategoria.innerHTML = "";
  categorias[categoria.value].forEach(s=>{
    subcategoria.innerHTML += `<option>${s}</option>`;
  });
}
categoria.onchange = cargarSub;
cargarSub();

// ================== TABS ==================
function mostrar(v){
  registro.style.display = v==="registro" ? "block" : "none";
  dashboard.style.display = v==="dashboard" ? "block" : "none";

  document.querySelectorAll(".tab button")
    .forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");

  if(v==="dashboard") dibujar();
}

// ================== GUARDAR ==================
function guardar(){
  const monto = parseFloat(`${dolares.value}.${centavos.value}`);
  if(isNaN(monto) || monto<=0){
    alert("Monto invÃ¡lido");
    return;
  }

  const gasto = {
    fecha: fecha.value,
    monto,
    categoria: categoria.value,
    subcategoria: subcategoria.value,
    beneficiario: beneficiario.value,
    lugar: lugar.value,
    pago: pago.value
  };

  const data = JSON.parse(localStorage.getItem("gastos") || "[]");
  data.push(gasto);
  localStorage.setItem("gastos", JSON.stringify(data));

  alert("âœ… Gasto guardado");
}

// ================== DASHBOARD ==================
function dibujar(){
  const data = JSON.parse(localStorage.getItem("gastos") || "[]");

  if(data.length === 0){
    resumen.innerHTML = "<p>ğŸ“­ AÃºn no hay gastos registrados</p>";
    return;
  }

  const totales = {};
  data.forEach(g=>{
    if(typeof g.monto === "number" && !isNaN(g.monto)){
      totales[g.categoria] = (totales[g.categoria] || 0) + g.monto;
    }
  });

  const canvas = document.getElementById("grafico");
  canvas.width = 320;
  canvas.height = 220;
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  let x = 20;
  resumen.innerHTML = "";

  for(let c in totales){
    const h = totales[c] * 4;
    ctx.fillStyle = "#007aff";
    ctx.fillRect(x, canvas.height - h - 20, 30, h);

    resumen.innerHTML += `<p>${c}: <b>$${totales[c].toFixed(2)}</b></p>`;
    x += 45;
  }
}

// ================== EXPORTAR ==================
function exportar(){
  const data = JSON.parse(localStorage.getItem("gastos") || "[]");
  let csv = "Fecha,Monto,Categoria,Subcategoria,Beneficiario,Lugar,MedioPago\n";

  data.forEach(g=>{
    csv += `${g.fecha},${g.monto},${g.categoria},${g.subcategoria},${g.beneficiario},${g.lugar},${g.pago}\n`;
  });

  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "gastos.csv";
  a.click();
}
</script>

</body>
</html>
