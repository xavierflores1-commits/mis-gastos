<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Gastos</title>

<style>
body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #f2f2f2;
  font-size: 18px;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 12px;
}

h2 {
  text-align: center;
}

.card {
  background: white;
  padding: 14px;
  border-radius: 10px;
  margin-bottom: 16px;
}

label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 17px;
}

textarea {
  resize: vertical;
}

button {
  background: #2e86de;
  color: white;
  border: none;
  border-radius: 8px;
  margin-top: 16px;
}

button.secondary {
  background: #27ae60;
}

.dashboard div {
  margin: 6px 0;
}
</style>
</head>

<body>
<div class="container">

<h2>ðŸ“Œ Registro de Gastos</h2>

<div class="card">
<form id="formGasto">

<label>Fecha</label>
<input type="date" id="fecha" required>

<label>CategorÃ­a</label>
<select id="categoria"></select>

<label>SubcategorÃ­a</label>
<select id="subcategoria"></select>

<label>Beneficiario</label>
<select id="beneficiario">
  <option>YO</option>
  <option>FAMILIA</option>
  <option>MASCOTAS</option>
  <option>OTRO</option>
</select>

<label>Lugar</label>
<select id="lugar">
  <option>CASA</option>
  <option>TRABAJO</option>
  <option>CALLE</option>
  <option>ONLINE</option>
  <option>OTRO</option>
</select>

<label>Monto</label>
<input type="number" id="monto" step="0.01" required>

<label>Medio de pago</label>
<select id="medioPago">
  <option>Efectivo</option>
  <option>DÃ©bito</option>
  <option>CrÃ©dito</option>
  <option>Transferencia</option>
</select>

<label>Detalle</label>
<textarea id="detalle"></textarea>

<label>ObservaciÃ³n</label>
<textarea id="observacion"></textarea>

<button type="submit">Guardar gasto</button>

</form>
</div>

<h2>ðŸ“Š Dashboard</h2>

<div class="card dashboard" id="dashboard"></div>

<button class="secondary" onclick="exportar()">ðŸ“¤ Exportar a Excel</button>

</div>

<script>
const categorias = {
  "ALIMENTACION": ["SOCIAL","SUPERMERCADO","RESTAURANTE","GIMNASIO","CAFE"],
  "TRANSPORTE": ["BUS","UBER","TAXI","TRICIMOTO"],
  "SALUD": ["CONSULTAS","EXAMENES","MEDICAMENTOS","SUPLEMENTOS","ASEO PERSONAL","SKINCARE"],
  "OCIO": ["CINE","VIAJES","SUBSCRIPCIONES"],
  "SOCIAL": ["HOTEL","AIRBNB","PAGOS"],
  "MASCOTAS": ["COMIDA","VETERINARIO","MEDICINA"],
  "AUTO": ["REPUESTOS","ACEITE","LAVADA","LLANTAS","MECANICO","FILTROS"],
  "OTROS": []
};

const categoria = document.getElementById("categoria");
const subcategoria = document.getElementById("subcategoria");
const dashboard = document.getElementById("dashboard");

function cargarCategorias() {
  categoria.innerHTML = "";
  Object.keys(categorias).forEach(c => {
    categoria.innerHTML += `<option>${c}</option>`;
  });
  actualizarSub();
}

function actualizarSub() {
  subcategoria.innerHTML = "";
  categorias[categoria.value].forEach(s => {
    subcategoria.innerHTML += `<option>${s}</option>`;
  });
}

categoria.onchange = actualizarSub;

document.getElementById("formGasto").onsubmit = e => {
  e.preventDefault();

  const gasto = {
    fecha: fecha.value,
    categoria: categoria.value,
    subcategoria: subcategoria.value,
    beneficiario: beneficiario.value,
    lugar: lugar.value,
    monto: Number(monto.value),
    medioPago: medioPago.value,
    detalle: detalle.value,
    observacion: observacion.value
  };

  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  gastos.push(gasto);
  localStorage.setItem("gastos", JSON.stringify(gastos));

  e.target.reset();
  cargarCategorias();
  actualizarDashboard();
};

function actualizarDashboard() {
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");

  if (gastos.length === 0) {
    dashboard.innerHTML = "No hay gastos registrados";
    return;
  }

  const total = gastos.reduce((s,g) => s + g.monto, 0);

  dashboard.innerHTML = `
    <div><strong>Total:</strong> $${total.toFixed(2)}</div>
    <div><strong>Registros:</strong> ${gastos.length}</div>
  `;
}

function exportar() {
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  if (!gastos.length) return;

  let csv = Object.keys(gastos[0]).join(",") + "\n";
  gastos.forEach(g => {
    csv += Object.values(g).join(",") + "\n";
  });

  const blob = new Blob([csv], {type: "text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "gastos.csv";
  a.click();
}

cargarCategorias();
actualizarDashboard();
</script>

</body>
</html>
