<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’¸ Control de Gastos</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f2f2f7;
  margin: 0;
  padding: 16px;
}
h1, h2 { text-align: center; }
.card {
  background: white;
  padding: 16px;
  border-radius: 14px;
  margin-bottom: 16px;
}
input, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 16px;
}
button {
  background: #007aff;
  color: white;
  border: none;
  margin-top: 16px;
}
nav {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
nav button { flex: 1; }
.hidden { display: none; }

.progress {
  height: 14px;
  background: #e5e5ea;
  border-radius: 10px;
  overflow: hidden;
  margin-top: 6px;
}
.progress-bar {
  height: 100%;
  background: #34c759;
}
.progress-bar.warn { background: #ff9f0a; }
.progress-bar.danger { background: #ff3b30; }
</style>
</head>

<body>

<h1>ğŸ’¸ Control de Gastos</h1>

<nav>
  <button onclick="mostrar('registro')">â• Registrar</button>
  <button onclick="mostrar('dashboard')">ğŸ“Š Dashboard</button>
  <button onclick="mostrar('presupuestos')">ğŸ¯ Presupuestos</button>
</nav>

<!-- REGISTRO -->
<section id="registro" class="card">
  <h2>â• Nuevo gasto</h2>

  <input type="date" id="fecha">

  <label>ğŸ’µ DÃ³lares</label>
  <select id="dolares"></select>

  <label>ğŸª™ Centavos</label>
  <select id="centavos"></select>

  <label>ğŸ“‚ CategorÃ­a</label>
  <select id="categoria" onchange="cargarSubcategorias()"></select>

  <label>ğŸ“ SubcategorÃ­a</label>
  <select id="subcategoria"></select>

  <label>ğŸ“ Lugar</label>
  <select id="lugar"></select>

  <label>ğŸ’³ Medio de pago</label>
  <select id="medioPago"></select>

  <label>ğŸ‘¤ Beneficiario</label>
  <select id="beneficiario">
    <option>Yo</option>
    <option>Familia</option>
    <option>Otros</option>
  </select>

  <button onclick="guardarGasto()">ğŸ’¾ Guardar</button>
</section>

<!-- DASHBOARD -->
<section id="dashboard" class="hidden">
  <div class="card">
    <h2>ğŸ“Š Dashboard</h2>
    <p id="totalGastado">$0.00</p>
    <canvas id="chartCategorias"></canvas>
  </div>
</section>

<!-- PRESUPUESTOS -->
<section id="presupuestos" class="hidden">
  <div class="card">
    <h2>ğŸ¯ Presupuestos mensuales</h2>
    <div id="listaPresupuestos"></div>
  </div>
</section>

<script>
/* ==========================
   DATOS DEFINITIVOS
========================== */

const categorias = {
  "ğŸ½ ALIMENTACIÃ“N": ["Supermercado","Restaurante","CafÃ©"],
  "ğŸš— TRANSPORTE": ["Gasolina","Uber/Taxi","Bus","Mantenimientos"],
  "ğŸ¥ SALUD": ["Medicamentos","ExÃ¡menes","Consultas"],
  "ğŸ‰ OCIO": ["Cine","Viajes","Suscripciones"],
  "ğŸ‘¥ SOCIAL": ["Regalos","CumpleaÃ±os","Salidas"],
  "ğŸ¶ MASCOTAS": ["Comida","Veterinario"],
  "ğŸš˜ AUTO": ["Repuestos","Mantenimiento"]
};

const lugares = [
  "Farmacia","Gasolinera","Supermercado","Tienda casa",
  "Restaurante","CafeterÃ­a","Veterinaria","Taller","Otro"
];

const mediosPago = [
  "ğŸ’µ Efectivo","ğŸ’³ Tarjeta","ğŸ“± Peigo","ğŸŒ Online-Gye","ğŸŒ Online-Peigo"
];

/* ==========================
   INIT
========================== */

function init() {
  fecha.value = new Date().toISOString().split("T")[0];

  for (let i = 0; i <= 500; i++)
    dolares.innerHTML += `<option>${i}</option>`;

  for (let i = 0; i < 100; i++)
    centavos.innerHTML += `<option>${i.toString().padStart(2,'0')}</option>`;

  for (let c in categorias)
    categoria.innerHTML += `<option>${c}</option>`;

  lugares.forEach(l => lugar.innerHTML += `<option>${l}</option>`);
  mediosPago.forEach(m => medioPago.innerHTML += `<option>${m}</option>`);

  cargarSubcategorias();
  cargarPresupuestos();
}
init();

/* ==========================
   REGISTRO
========================== */

function cargarSubcategorias(){
  subcategoria.innerHTML = "";
  categorias[categoria.value].forEach(s =>
    subcategoria.innerHTML += `<option>${s}</option>`
  );
}

function guardarGasto(){
  const gasto = {
    fecha: fecha.value,
    monto: +dolares.value + +("0."+centavos.value),
    categoria: categoria.value,
    subcategoria: subcategoria.value,
    lugar: lugar.value,
    medioPago: medioPago.value,
    beneficiario: beneficiario.value
  };

  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  gastos.push(gasto);
  localStorage.setItem("gastos", JSON.stringify(gastos));

  alert("âœ… Gasto guardado");
}

/* ==========================
   NAVEGACIÃ“N
========================== */

function mostrar(id){
  ["registro","dashboard","presupuestos"].forEach(s =>
    document.getElementById(s).classList.add("hidden")
  );
  document.getElementById(id).classList.remove("hidden");

  if (id === "dashboard") actualizarDashboard();
  if (id === "presupuestos") cargarPresupuestos();
}

/* ==========================
   DASHBOARD
========================== */

function actualizarDashboard(){
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  const total = gastos.reduce((a,b)=>a+b.monto,0);
  totalGastado.innerText = "$" + total.toFixed(2);

  const porCategoria = {};
  gastos.forEach(g =>
    porCategoria[g.categoria] = (porCategoria[g.categoria] || 0) + g.monto
  );

  new Chart(chartCategorias, {
    type: "pie",
    data: {
      labels: Object.keys(porCategoria),
      datasets: [{ data: Object.values(porCategoria) }]
    }
  });
}

/* ==========================
   PRESUPUESTOS
========================== */

function cargarPresupuestos(){
  const presup = JSON.parse(localStorage.getItem("presupuestos") || "{}");
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  listaPresupuestos.innerHTML = "";

  for (let c in categorias) {
    if (!presup[c]) presup[c] = 0;

    const gastado = gastos
      .filter(g => g.categoria === c)
      .reduce((a,b)=>a+b.monto,0);

    const pct = presup[c] ? Math.min(gastado / presup[c] * 100, 100) : 0;
    let clase = pct > 90 ? "danger" : pct > 70 ? "warn" : "";

    listaPresupuestos.innerHTML += `
      <div style="margin-bottom:14px">
        <strong>${c}</strong>
        <input type="number" value="${presup[c]}"
          onchange="guardarPresupuesto('${c}',this.value)">
        <div class="progress">
          <div class="progress-bar ${clase}" style="width:${pct}%"></div>
        </div>
        <small>$${gastado.toFixed(2)} / $${presup[c]}</small>
      </div>
    `;
  }
}

function guardarPresupuesto(cat,val){
  const p = JSON.parse(localStorage.getItem("presupuestos") || "{}");
  p[cat] = +val;
  localStorage.setItem("presupuestos", JSON.stringify(p));
}
</script>

</body>
</html>
