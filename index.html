<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gastos</title>

<style>
body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #f4f6f8;
  font-size: 18px;
  color: #222;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 14px;
}

h2 {
  text-align: center;
  margin-bottom: 10px;
}

.card {
  background: #ffffff;
  padding: 14px;
  border-radius: 12px;
  margin-bottom: 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 17px;
}

input[type=number] {
  text-align: center;
}

textarea {
  resize: vertical;
}

button {
  background: #2c3e50;
  color: white;
  border: none;
  border-radius: 10px;
  margin-top: 16px;
}

button.export {
  background: #27ae60;
}

.dashboard div {
  margin: 6px 0;
}
</style>
</head>

<body>
<div class="container">

<h2>ğŸ§¾ Registro</h2>

<div class="card">
<form id="formGasto">

<label>ğŸ“… Fecha</label>
<input type="date" id="fecha" required>

<label>ğŸ“‚ Categoria</label>
<select id="categoria"></select>

<label>ğŸ“ Subcategoria</label>
<select id="subcategoria"></select>

<label>ğŸ‘¤ Beneficiario</label>
<select id="beneficiario">
  <option>YO</option>
  <option>FAMILIA</option>
  <option>MASCOTAS</option>
  <option>OTROS</option>
</select>

<label>ğŸ“ Lugar</label>
<select id="lugar">
  <option>CASA</option>
  <option>TRABAJO</option>
  <option>CALLE</option>
  <option>ONLINE</option>
</select>

<label>ğŸ’µ Monto</label>
<input type="number" id="monto" step="0.01" min="0" value="0" required>

<label>ğŸ’³ Medio de pago</label>
<select id="medioPago">
  <option>EFECTIVO</option>
  <option>DEBITO</option>
  <option>CREDITO</option>
  <option>TRANSFERENCIA</option>
</select>

<label>ğŸ“ Detalle</label>
<textarea id="detalle"></textarea>

<label>ğŸ—’ï¸ Observacion</label>
<textarea id="observacion"></textarea>

<button type="submit">Guardar</button>

</form>
</div>

<h2>ğŸ“Š Dashboard</h2>

<div class="card dashboard" id="dashboard"></div>

<button class="export" onclick="exportar()">ğŸ“¤ Exportar a Excel</button>

</div>

<script>
const PRESUPUESTO_MENSUAL = 500;

const categorias = {
  ALIMENTACION: ["SOCIAL","SUPERMERCADO","RESTAURANTE","GIMNASIO","CAFE"],
  TRANSPORTE: ["BUS","UBER","TAXI","TRICIMOTO"],
  SALUD: ["CONSULTAS","EXAMENES","MEDICAMENTOS","SUPLEMENTOS","ASEO PERSONAL","SKINCARE"],
  OCIO: ["CINE","VIAJES","SUBSCRIPCIONES"],
  SOCIAL: ["HOTEL","AIRBNB","PAGOS"],
  MASCOTAS: ["COMIDA","VETERINARIO","MEDICINA"],
  AUTO: ["REPUESTOS","ACEITE","LAVADA","LLANTAS","MECANICO","FILTROS"],
  OTROS: []
};

const categoria = document.getElementById("categoria");
const subcategoria = document.getElementById("subcategoria");
const dashboard = document.getElementById("dashboard");

function cargarCategorias() {
  categoria.innerHTML = "";
  Object.keys(categorias).forEach(c => {
    categoria.innerHTML += `<option>${c}</option>`;
  });
  actualizarSub();
}

function actualizarSub() {
  subcategoria.innerHTML = "";
  categorias[categoria.value].forEach(s => {
    subcategoria.innerHTML += `<option>${s}</option>`;
  });
}

categoria.onchange = actualizarSub;

document.getElementById("formGasto").onsubmit = e => {
  e.preventDefault();

  const gasto = {
    fecha: fecha.value,
    categoria: categoria.value,
    subcategoria: subcategoria.value,
    beneficiario: beneficiario.value,
    lugar: lugar.value,
    monto: Number(monto.value),
    medioPago: medioPago.value,
    detalle: detalle.value,
    observacion: observacion.value
  };

  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  gastos.push(gasto);
  localStorage.setItem("gastos", JSON.stringify(gastos));

  e.target.reset();
  cargarCategorias();
  actualizarDashboard();
};

function actualizarDashboard() {
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  const mesActual = new Date().toISOString().slice(0,7);

  const delMes = gastos.filter(g => g.fecha.startsWith(mesActual));

  if (delMes.length === 0) {
    dashboard.innerHTML = "Sin gastos este mes";
    return;
  }

  let total = 0;
  const porCategoria = {};

  delMes.forEach(g => {
    total += g.monto;
    porCategoria[g.categoria] = (porCategoria[g.categoria] || 0) + g.monto;
  });

  let html = `<div><strong>Total mes:</strong> $${total.toFixed(2)}</div>`;
  html += `<div><strong>Uso presupuesto:</strong> ${((total / PRESUPUESTO_MENSUAL)*100).toFixed(1)}%</div><hr>`;

  Object.keys(porCategoria).forEach(c => {
    html += `<div>${c}: $${porCategoria[c].toFixed(2)}</div>`;
  });

  dashboard.innerHTML = html;
}

function exportar() {
  const gastos = JSON.parse(localStorage.getItem("gastos") || "[]");
  if (!gastos.length) return;

  let csv = Object.keys(gastos[0]).join(",") + "\n";
  gastos.forEach(g => {
    csv += Object.values(g).join(",") + "\n";
  });

  const blob = new Blob([csv], {type: "text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "gastos.csv";
  a.click();
}

cargarCategorias();
actualizarDashboard();
</script>

</body>
</html>
